# How have imports of goods, services, and primary income evolved relative to exports of goods, services, and primary income in Gabon between 1980 and 2015?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "external-debt_gab_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Gabon dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Imports of goods, services and primary income (BoP, current US$)"], 
         marker='o', linestyle='-', label="Imports of goods, services and primary income (BoP, current US$)")
plt.plot(df_plot["Year"], df_plot["Exports of goods, services and primary income (BoP, current US$)"], 
         marker='o', linestyle='-', label="Exports of goods, services and primary income (BoP, current US$)")

plt.title("Gabon: Imports vs Exports of goods, services and primary income (BoP, current US$) (1980-2015)")
plt.xlabel("Year")
plt.ylabel("Number (BoP, current US$)")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "gabon_imports_vs_exports_of_goods_services_and_primary_income.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "gabon_imports_vs_exports_of_goods_services_and_primary_income"), index=False)
